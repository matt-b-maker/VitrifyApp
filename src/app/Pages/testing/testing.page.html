<app-side-menu-header>

</app-side-menu-header>

<ion-content>
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Test yo SHIT</ion-title>
    </ion-toolbar>
  </ion-header>
  <div *ngIf="loaded">
    <ion-item *ngIf="testingService.testBatches.length === 0">
      <div>
        <ion-label>No test batches yet</ion-label>
        <ion-label>Click the button below to add one</ion-label>
      </div>
    </ion-item>
    <ion-list *ngIf="testingService.testBatches.length > 0">
      <ion-item *ngFor="let testBatch of testingService.testBatches; let i = index">
        <ion-grid>
          <ion-row>
            <ion-col size="5">
              <ion-label (click)="showTestBatchDetails(testBatch)">{{testBatch.name}}</ion-label>
            </ion-col>
            <ion-col size="3">
              <ion-label>{{getTileSetupString(i)}}</ion-label>
            </ion-col>
            <ion-col size="2">
              <ion-icon name="create" (click)="editTestBatch(testBatch)"></ion-icon>
            </ion-col>
            <ion-col size="2">
              <ion-icon name="trash" (click)="deleteTestBatch(testBatch)"></ion-icon>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>
    </ion-list>
    <ion-modal id="editingModal" [isOpen]="editingModalOpen">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>{{editOrAdd}}</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="closeModalAndSave()">Close and Save</ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content>
          <ion-item>
            <ion-input [(ngModel)]="testBatchUnderEdit.name" label="Batch Name" labelPlacement="floating"></ion-input>
            <ion-input id="startingTilesInput" label="Tile Count" labelPlacement="floating" type="number" [clearOnEdit]="true" [value]="testBatchUnderEdit.tiles.length" (ionBlur)="setTileCount($event)" (keyup.enter)="setTileCount($event)"></ion-input>
          </ion-item>
          <ion-card *ngFor="let testTile of testBatchUnderEdit?.tiles; let i = index" #itemSliding class="slide-in-animation tile slide-item tile-{{i}}">
            <ion-toolbar>
              <ion-card-header slot="start">
                <ion-card-title *ngIf="!testTile.inputTitleMode" (click)="makeTitleEditable(i)">
                  Tile {{ testTile.number }}
                </ion-card-title>
                <ion-input id="titleInput" class="title-input-{{i}}" *ngIf="testTile.inputTitleMode" [(ngModel)]="testTile.number" (ionBlur)="makeTitleReadOnly(i)" (blur)="makeTitleReadOnly(i)" (keyup.enter)="unfocusInput(i)">
                </ion-input>
              </ion-card-header>
              <ion-buttons slot="end">
                <ion-button (click)="addLayerToTile(i)">Add Layer</ion-button>
                <ion-icon name="trash" (click)="deleteTile(i)"></ion-icon>
              </ion-buttons>
            </ion-toolbar>
            <ion-card-content>
              <ion-list>
                <ion-item-sliding *ngFor="let recipe of testTile.recipes; let j = index" #itemSliding class="slide-in-animation slide-item">
                  <ion-item>
                    <ion-grid>
                      <ion-row>
                        <ion-col size="7">
                          <ion-select [value]="testTile.recipes[j]" (ionChange)="setLayerDetails($event, i, j)">
                            <ion-select-option *ngFor="let recipe of recipesService.userRecipes" [value]="recipe">{{recipe.name}}</ion-select-option>
                          </ion-select>
                        </ion-col>
                        <ion-col>
                          <ion-label *ngIf="recipe.revisions.length === 1">Revision 1</ion-label>
                          <ion-select [value]="recipe.revisions.length" (ionChange)="setLayerRevision($event, i, j)" *ngIf="recipe.revisions.length > 1">
                            <ion-select-option *ngFor="let revision of recipe.revisions" [value]="revision">{{revision.revision}}</ion-select-option>
                          </ion-select>
                        </ion-col>
                        <ion-col size="auto">
                          <div style="width: 150;">
                            <ion-icon name="trash" (click)="removeRecipeFromTile(i, j)"></ion-icon>
                          </div>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item>
                </ion-item-sliding>
              </ion-list>
            </ion-card-content>
          </ion-card>
          <div style="margin-top: 100px;">

          </div>
        </ion-content>
        <ion-fab class="ion-margin" vertical="bottom" horizontal="end" slot="fixed">
          <ion-fab-button>
            <ion-icon id="" (click)="addTileToBatch()" name="add"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ng-template>
    </ion-modal>
    <ion-modal id="detailsModal" [isOpen]="detailsModalOpen">
      <ng-template>
        <ion-content>
          <ion-header>
            <ion-toolbar>
              <ion-title>{{testBatchUnderEdit.name}}</ion-title>
              <ion-buttons slot="end">
                <ion-button (click)="closeDetailsModal()">Close</ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-card *ngFor="let tile of testBatchUnderEdit.tiles; let i = index">
            <ion-card-header>
              <ion-card-title>{{tile.number}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label></ion-label>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-content>
      </ng-template>
    </ion-modal>
  </div>
  <ion-list *ngIf="!loaded">
    <ion-list-header>
      <ion-skeleton-text
        [animated]="true"
        style="width: 80px"
      ></ion-skeleton-text>
    </ion-list-header>
    <ion-item>
      <ion-thumbnail slot="start">
        <ion-skeleton-text [animated]="true"></ion-skeleton-text>
      </ion-thumbnail>
      <ion-label>
        <h3>
          <ion-skeleton-text
            [animated]="true"
            style="width: 80%"
          ></ion-skeleton-text>
        </h3>
        <p>
          <ion-skeleton-text
            [animated]="true"
            style="width: 60%"
          ></ion-skeleton-text>
        </p>
        <p>
          <ion-skeleton-text
            [animated]="true"
            style="width: 30%"
          ></ion-skeleton-text>
        </p>
      </ion-label>
    </ion-item>
  </ion-list>
  <ion-fab class="ion-margin" vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button [disabled]="!loaded">
      <ion-icon id="add-inventory" (click)="addTestBatch()" name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
