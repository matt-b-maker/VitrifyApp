<app-side-menu-header title=""></app-side-menu-header>

<ion-content [fullscreen]="true">
  <!-- <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Recipe</ion-title>
    </ion-toolbar>
  </ion-header> -->
  <ion-card>
    <ion-card-header>
      <ion-toolbar>
        <ion-card-title>Recipe Builder</ion-card-title>
        <ion-card-subtitle>Let's write a GOD DAMN recipe</ion-card-subtitle>
        <div slot="end">
          <ion-button slot="end" (click)="aiGenerateRecipe()"
            >Generate</ion-button
          >
        </div>
      </ion-toolbar>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row class="">
          <ion-col size="9">
            <ion-input
              fill="outline"
              label="Recipe Name"
              labelPlacement="stacked"
              [value]="recipeService.recipeInProgess.name"
              (input)="setName($event)"
            ></ion-input>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="3">
            <ion-input
              label="Cone"
              labelPlacement="stacked"
              fill="outline"
              [value]="recipeService.recipeInProgess.cone"
              [clearOnEdit]="true"
              type="number"
              #coneInput
              (input)="setCone($event)"
            ></ion-input>
            <!-- <ion-select interface="action-sheet" label="Cone" labelPlacement="stacked" fill="outline" [value]="cone" (ionChange)="setCone($event)">
              <ion-select-option *ngFor="let coneSelection of cones" [value]="coneSelection">{{coneSelection}}</ion-select-option>
            </ion-select> -->
          </ion-col>
          <ion-col size="6">
            <ion-select
              [(ngModel)]="recipeService.recipeInProgess.firingType"
              label="Firing Type"
              labelPlacement="stacked"
              fill="outline"
            >
              <ion-select-option *ngFor="let type of firingTypes" [value]="type"
                >{{type}}</ion-select-option
              >
            </ion-select>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-input
              fill="outline"
              label="Description"
              labelPlacement="stacked"
              [value]="recipeService.recipeInProgess.description"
              [autocorrect]="true"
              (input)="setDescription($event)"
            ></ion-input>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-toolbar>
        <ion-card-title>Ingredients</ion-card-title>
        <ion-button slot="end" (click)="addIngredient()">Add</ion-button>
      </ion-toolbar>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row
          class="ingredient slide-in-animation"
          *ngFor="let ingredient of recipeService.recipeInProgess.revisions[0].ingredients; let i = index"
        >
          <ion-grid>
            <ion-row>
              <ion-col size="8">
                <ion-item class="">
                  <ionic-selectable
                    class="item-content"
                    [(ngModel)]="recipeService.recipeInProgess.revisions[0].ingredients[i].name"
                    [items]="allMaterials"
                    itemTextField="listName"
                    [canSearch]="true"
                    (onSearch)="searchIngredients($event)"
                    (onClose)="allMaterials = ingredientService.allMaterials"
                    (onClear)="allMaterials = ingredientService.allMaterials"
                    (onChange)="updateMaterialsList($event)"
                  >
                  <!-- <ng-template ionicSelectableItemTemplate let-ingredient="item" let-isIngredientSelected="isItemSelected">
                    {{ ingredient.name }} ({{ ingredient.listName }})
                  </ng-template> -->

                  <!-- Use end-template for customizing the end template -->
                  <ng-template ionicSelectableItemEndTemplate let-ingredient="item">
                    <img class="" [src]="ingredient.imageUrl" />
                  </ng-template>
                  </ionic-selectable>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Notes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-textarea
        fill="outline"
        [maxlength]="300"
        [value]="recipeService.recipeInProgess.notes"
        [autoGrow]="true"
        (input)="setNotes($event)"
      ></ion-textarea>
    </ion-card-content>
  </ion-card>
</ion-content>
<ion-footer>
  <ion-toolbar>
    <ion-label slot="start" class="ion-margin"
      >Total: {{totalPercentage}}%</ion-label
    >
    <ion-label
      slot="end"
      [ngClass]="remainingPercentageOver ? 'red' : 'black'"
      class="ion-margin"
      >Remaining: {{remainingPercentage}}%</ion-label
    >
  </ion-toolbar>
</ion-footer>
